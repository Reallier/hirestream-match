# TalentAI 系统验收清单

## 验收标准（Go/No-Go）

### 1. 质量标准
- [ ] **匹配准确率**: Top10 合理率 ≥ 70%
- [ ] **证据完整性**: 每个匹配结果有 ≥2 条证据
- [ ] **必备技能覆盖**: "必备全覆盖"开关有效

### 2. 性能标准
- [ ] **入库时效**: 简历入库后 ≤ 2 分钟可被检索到
- [ ] **匹配响应**: /match API P95 响应时间 ≤ 1 秒
- [ ] **系统可用性**: 服务可用性 ≥ 99%

### 3. 治理标准
- [ ] **可追溯性**: 能回溯任意字段的来源
- [ ] **审计日志**: 一键删除并生成审计记录
- [ ] **数据完整性**: 删除操作正确清理原文/索引/向量

### 4. 弹性标准
- [ ] **降级机制**: 关闭向量召回仍能获得"可用"的排序结果
- [ ] **错误处理**: LLM 失败时有合理降级
- [ ] **重试机制**: 入库失败有重试逻辑

---

## 功能验收清单

### A. 简历入库 (Resume Ingestion)

#### A1. 文件上传
- [ ] 支持 PDF 格式上传
- [ ] 支持 DOCX 格式上传
- [ ] 文件大小限制生效（默认 10MB）
- [ ] 不支持的格式正确拒绝

#### A2. 简历解析
- [ ] 正确提取姓名、邮箱、电话
- [ ] 正确提取工作经历（公司、职位、时间）
- [ ] 正确提取技能列表
- [ ] 正确提取教育背景
- [ ] 支持中英文混合简历

#### A3. 去重判断
- [ ] **强匹配**: 邮箱一致→识别为同人
- [ ] **强匹配**: 电话一致→识别为同人
- [ ] **弱匹配**: 姓名+公司相似度→提示可能重复
- [ ] **哈希判重**: 相同文本哈希→识别为重复简历

#### A4. 数据合并
- [ ] 新数据优先策略正确执行
- [ ] 非空优先策略正确执行
- [ ] 合并谱系完整记录
- [ ] 技能列表正确合并去重

#### A5. 索引建立
- [ ] 全文索引正确创建
- [ ] 向量索引正确创建
- [ ] 技能新鲜度正确计算
- [ ] 索引在 2 分钟内完成

**测试命令**:
```bash
# 1. 上传简历测试
curl -X POST "http://localhost:8000/api/candidates/ingest" \
  -F "file=@test_resume.pdf"

# 2. 验证候选人创建
curl "http://localhost:8000/api/candidates/1"

# 3. 验证索引创建
curl "http://localhost:8000/api/search?q=Python"
```

---

### B. JD 匹配 (Job Matching)

#### B1. JD 解析
- [ ] 正确提取必备技能 (must_skills)
- [ ] 正确提取加分技能 (nice_skills)
- [ ] 正确提取过滤条件 (location, years, etc.)
- [ ] 解析失败时有降级处理

#### B2. 双路召回
- [ ] **关键词召回**: PostgreSQL 全文搜索工作正常
- [ ] **向量召回**: pgvector 相似度搜索工作正常
- [ ] 两路结果正确合并去重
- [ ] TopK 参数生效

#### B3. 融合排序
- [ ] 向量相似度分数正确计算
- [ ] 关键词分数正确计算
- [ ] 技能覆盖度分数正确计算
- [ ] 新鲜度分数正确计算
- [ ] 综合分数按权重正确融合

#### B4. 证据生成
- [ ] 每个匹配返回 ≥2 条证据
- [ ] 证据包含：技能、片段、时间段
- [ ] 缺口清单正确列出缺失技能
- [ ] 证据可回溯到原文

#### B5. 过滤功能
- [ ] 地点过滤生效
- [ ] 工作年限过滤生效
- [ ] 学历过滤生效
- [ ] 必备技能全覆盖开关生效

**测试命令**:
```bash
# 1. JD 匹配测试
curl -X POST "http://localhost:8000/api/match" \
  -H "Content-Type: application/json" \
  -d '{
    "jd": "招聘 Python 后端工程师，3年以上经验，熟悉 FastAPI、PostgreSQL、Redis",
    "top_k": 10,
    "explain": true
  }'

# 2. 带过滤条件的匹配
curl -X POST "http://localhost:8000/api/match" \
  -H "Content-Type: application/json" \
  -d '{
    "jd": "招聘 Java 工程师",
    "filters": {"location": "北京", "min_years": 3},
    "top_k": 10
  }'
```

---

### C. 候选人搜索 (Candidate Search)

#### C1. 关键词搜索
- [ ] 支持中文关键词搜索
- [ ] 支持英文关键词搜索
- [ ] 支持多关键词搜索
- [ ] 搜索结果按相关度排序
- [ ] 返回匹配片段高亮

#### C2. 候选人列表
- [ ] 分页功能正常
- [ ] 状态过滤生效
- [ ] 返回正确的候选人信息

#### C3. 候选人详情
- [ ] 返回完整的基本信息
- [ ] 返回所有工作经历
- [ ] 返回所有项目经历
- [ ] 返回教育背景
- [ ] 返回索引更新时间

**测试命令**:
```bash
# 1. 关键词搜索
curl "http://localhost:8000/api/search?q=Python+FastAPI&top_k=20"

# 2. 候选人列表
curl "http://localhost:8000/api/candidates?limit=20&status=active"

# 3. 候选人详情
curl "http://localhost:8000/api/candidates/1"
```

---

### D. 系统管理 (System Management)

#### D1. 索引管理
- [ ] 重建索引功能正常
- [ ] 支持指定候选人 ID 重建
- [ ] 支持按时间范围重建
- [ ] 返回成功/失败统计

#### D2. 数据删除
- [ ] 删除候选人功能正常
- [ ] 级联删除相关数据
- [ ] 生成审计日志
- [ ] 清理索引和向量

#### D3. 统计信息
- [ ] 返回总候选人数
- [ ] 返回活跃候选人数
- [ ] 返回简历总数

**测试命令**:
```bash
# 1. 重建索引
curl -X POST "http://localhost:8000/api/reindex" \
  -H "Content-Type: application/json" \
  -d '{"candidate_ids": [1, 2, 3]}'

# 2. 系统统计
curl "http://localhost:8000/api/stats"

# 3. 删除候选人
curl -X DELETE "http://localhost:8000/api/candidates/999"
```

---

### E. 前端界面 (Frontend UI)

#### E1. JD 匹配界面
- [ ] 可以输入 JD 文本
- [ ] 可以设置过滤条件
- [ ] 显示匹配结果列表
- [ ] 显示匹配分数
- [ ] 显示证据条
- [ ] 点击展开详情

#### E2. 简历上传界面
- [ ] 支持点击上传
- [ ] 支持拖拽上传
- [ ] 显示上传进度
- [ ] 显示上传结果
- [ ] 显示错误信息

#### E3. 候选人搜索界面
- [ ] 可以输入关键词
- [ ] 显示搜索结果
- [ ] 显示匹配片段
- [ ] 显示候选人技能

#### E4. 系统统计界面
- [ ] 显示候选人统计
- [ ] 显示简历统计
- [ ] 数据实时更新

---

### F. 降级与容错 (Degradation & Fault Tolerance)

#### F1. LLM 服务降级
- [ ] JD 解析失败时返回空结果继续执行
- [ ] Embedding 生成失败时跳过向量召回
- [ ] 证据生成失败时返回简单匹配列表

#### F2. 数据库容错
- [ ] 向量索引不可用时仅用全文搜索
- [ ] 全文索引不可用时仅用向量搜索
- [ ] 数据库连接失败有重试机制

#### F3. 错误处理
- [ ] API 错误返回明确的错误信息
- [ ] 前端显示友好的错误提示
- [ ] 记录详细的错误日志

---

## 性能测试

### 响应时间测试
```bash
# 使用 Apache Bench 测试 /match 接口
ab -n 100 -c 10 -p jd.json -T application/json \
  http://localhost:8000/api/match
```

### 并发测试
```bash
# 测试 20 个并发用户
ab -n 200 -c 20 http://localhost:8000/api/search?q=Python
```

### 索引时效测试
```bash
# 1. 上传简历并记录时间
time curl -X POST "http://localhost:8000/api/candidates/ingest" \
  -F "file=@resume.pdf"

# 2. 等待并检查是否可搜索
sleep 120
curl "http://localhost:8000/api/search?q=候选人姓名"
```

---

## 数据质量测试

### 创建示例数据
```bash
# 进入后端容器
docker-compose exec backend bash

# 运行示例数据脚本
python create_sample_data.py
```

### 验证匹配质量
1. 使用 5 个不同的 JD 进行匹配测试
2. 人工评估 Top10 结果的合理性
3. 检查是否每个结果都有证据
4. 验证必备技能过滤是否生效

---

## 验收流程

### 第一步：环境检查
```bash
# 1. 检查服务状态
docker-compose ps

# 2. 检查健康端点
curl http://localhost:8000/health

# 3. 检查前端访问
curl http://localhost:3000
```

### 第二步：创建测试数据
```bash
# 运行示例数据脚本
docker-compose exec backend python create_sample_data.py
```

### 第三步：运行自动化测试
```bash
# 给脚本执行权限
chmod +x test_api.sh

# 运行测试
./test_api.sh
```

### 第四步：手动功能测试
1. 访问前端界面 http://localhost:3000
2. 测试简历上传功能
3. 测试 JD 匹配功能
4. 测试候选人搜索功能
5. 检查系统统计数据

### 第五步：性能验证
1. 测试匹配接口响应时间
2. 测试入库到可检索的时间
3. 进行并发测试

### 第六步：质量评估
1. 评估匹配准确率
2. 检查证据完整性
3. 验证降级机制

---

## 验收报告模板

```
TalentAI 系统验收报告
日期：____________________
验收人：__________________

一、功能验收
□ 简历入库功能完整
□ JD 匹配功能正常
□ 候选人搜索功能正常
□ 系统管理功能正常
□ 前端界面功能完整

二、性能验收
□ 入库时效 ≤ 2 分钟
□ 匹配响应 ≤ 1 秒
□ 系统稳定运行

三、质量验收
□ Top10 合理率 ≥ 70%
□ 证据完整性满足要求
□ 数据可追溯

四、问题记录
1. ____________________________
2. ____________________________

五、验收结论
□ 通过
□ 不通过（原因：____________）

签名：________________
```

---

## 常见问题排查

### 问题1：服务无法启动
- 检查 Docker 和 Docker Compose 版本
- 检查端口占用（5432, 8000, 3000）
- 查看日志：`docker-compose logs`

### 问题2：OpenAI API 调用失败
- 检查 API Key 是否正确配置
- 检查网络连接
- 查看后端日志：`docker-compose logs backend`

### 问题3：向量搜索不工作
- 检查 pgvector 扩展是否安装
- 检查索引是否创建成功
- 运行重建索引：`curl -X POST http://localhost:8000/api/reindex`

### 问题4：简历解析失败
- 检查文件格式和大小
- 查看详细错误日志
- 尝试不同的简历文件

---

**验收完成后，系统即可投入生产使用！** 🎉