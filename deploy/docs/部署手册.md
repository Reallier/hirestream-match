# TalentAI 企业私有化部署手册

> **版本**：1.0.0 | **更新时间**：2026-01-20

## 概述

本手册指导企业客户完成 TalentAI 私有化版本的部署和配置。

## 系统要求

### 硬件要求

| 配置 | 最低要求 | 推荐配置 |
|:-----|:--------|:--------|
| **CPU** | 2 核 | 4 核+ |
| **内存** | 4 GB | 8 GB+ |
| **磁盘** | 20 GB SSD | 50 GB+ SSD |
| **网络** | 100 Mbps | 1 Gbps |

### 软件要求

| 软件 | 版本要求 |
|:-----|:--------|
| **操作系统** | Ubuntu 20.04+, CentOS 8+, Windows Server 2019+ |
| **Docker** | 20.10+ |
| **Docker Compose** | v2.0+ |

### 网络要求

- 内网部署需要开放以下端口：
  - `3000`: 前端 Web 服务
  - `8000`: 后端 API 服务
  - `5432`: PostgreSQL（仅内部访问）

- 如需使用阿里云 DashScope AI 服务，需允许访问：
  - `dashscope.aliyuncs.com:443`

---

## 快速安装

### Linux 系统

```bash
# 1. 解压部署包
tar -xzf talentai-private-v1.0.0.tar.gz
cd talentai-private-v1.0.0

# 2. 运行安装脚本
chmod +x install.sh
sudo ./install.sh

# 3. 编辑配置文件
sudo nano .env

# 4. 启动服务
sudo docker compose -f compose.private.yml up -d
```

### Windows 系统

```powershell
# 1. 解压部署包到 C:\TalentAI

# 2. 以管理员身份运行 PowerShell
cd C:\TalentAI
.\install.ps1

# 3. 编辑配置文件
notepad .env

# 4. 启动服务
docker compose -f compose.private.yml up -d
```

---

## 配置说明

### 必须配置项

| 配置项 | 说明 | 示例 |
|:------|:-----|:-----|
| `DATABASE_PASSWORD` | 数据库密码 | `MySecurePassword123!` |
| `DASHSCOPE_API_KEY` | 阿里云 DashScope API Key | `sk-xxxxxx` |
| `JWT_SECRET` | JWT 签名密钥 | `openssl rand -hex 32` 生成 |
| `LICENSE_PUBLIC_KEY` | License 公钥 | 由 INTJsys 提供 |

### 阿里云 DashScope API Key 申请

1. 访问 [DashScope 控制台](https://dashscope.console.aliyun.com/)
2. 开通通义千问大模型服务
3. 创建 API Key
4. 将 API Key 填入 `.env` 文件

---

## License 激活

### 步骤 1：获取机器指纹

```bash
curl http://localhost:8000/api/license/machine-id
```

响应示例：
```json
{
  "machine_id": "a51baa3f4841673cffd3fcbc8052fdc8",
  "platform": "Linux 5.15.0",
  "generated_at": "2026-01-20T06:30:00Z"
}
```

### 步骤 2：申请 License

将以下信息发送给 INTJsys 销售团队：

- **Machine ID**: （上一步获取）
- **客户名称**: 贵公司全称
- **版本需求**: 标准版 / 专业版 / 企业版
- **订单号**: （如有）

联系方式：
- 邮箱：license@intjsys.com
- 电话：400-xxx-xxxx

### 步骤 3：激活 License

收到 License Key 后，执行：

```bash
curl -X POST http://localhost:8000/api/license/activate \
  -H "Content-Type: application/json" \
  -d '{"license_key": "eyJhbGciOiJSUzI1NiIs..."}'
```

激活成功响应：
```json
{
  "success": true,
  "message": "License 激活成功！欢迎 XX公司，专业版授权已生效。",
  "status": {
    "is_valid": true,
    "edition": "professional",
    "max_users": 200,
    "expires_at": "2027-01-20T00:00:00Z"
  }
}
```

### 步骤 4：验证激活状态

```bash
curl http://localhost:8000/api/license/status
```

---

## 日常运维

### 查看服务状态

```bash
docker compose -f compose.private.yml ps
```

### 查看日志

```bash
# 所有服务
docker compose -f compose.private.yml logs -f

# 仅后端
docker compose -f compose.private.yml logs -f talentai-backend
```

### 重启服务

```bash
docker compose -f compose.private.yml restart
```

### 停止服务

```bash
docker compose -f compose.private.yml down
```

### 数据备份

```bash
# 备份数据库
docker exec talentai_db pg_dump -U talentai talentai > backup_$(date +%Y%m%d).sql

# 备份上传文件
tar -czf uploads_backup_$(date +%Y%m%d).tar.gz /var/lib/docker/volumes/talentai_uploads
```

---

## 故障排查

### License 激活失败

**问题**：提示 "机器指纹不匹配"

**原因**：License 绑定的 Machine ID 与当前服务器不一致

**解决**：
1. 确认是否在正确的服务器上激活
2. 如服务器已迁移，需联系 INTJsys 重新签发 License

### 无法连接数据库

**问题**：后端日志显示 "connection refused"

**检查**：
```bash
docker compose -f compose.private.yml ps talentai-db
docker compose -f compose.private.yml logs talentai-db
```

### AI 服务调用失败

**问题**：即时匹配返回错误

**检查**：
1. 确认 `DASHSCOPE_API_KEY` 配置正确
2. 确认网络可以访问 `dashscope.aliyuncs.com`
3. 查看后端日志：`docker compose logs talentai-backend | grep -i error`

---

## 升级指南

1. 下载新版本部署包
2. 备份数据库和上传文件
3. 停止服务：`docker compose down`
4. 替换 Docker 镜像
5. 启动服务：`docker compose up -d`
6. 验证功能正常

---

## 技术支持

- **工单系统**：support.intjsys.com
- **邮箱**：support@intjsys.com
- **电话**：400-xxx-xxxx（工作日 9:00-18:00）

企业版客户享有专属技术顾问服务。
